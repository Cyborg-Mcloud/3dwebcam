<!DOCTYPE html>
<html>
  <head>

  	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>3D Webcam</title>

        <meta charset="utf-8" />
        <meta name="format-detection" content="telephone=no" />
        <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1" />

	<script type="text/javascript" charset="utf-8" src="cordova.js"></script>
	<script type="text/javascript" charset="utf-8" src="metawear.js"></script>

  </head>
  <style>
	body {color:white; margin:0px; padding:0px;}
	a {text-decoration:none; color:white;}
  </style>
  <body style='padding:0; border:0; margin:0;'>
  <Table>
  <tr><td>
                <button id="disconnectButton">Disconnect</button>
                <button id="connectButton">Connect</button>

  <h3>Colors</h3>
		<button id="ledButtonred">LEDred</button><br />
	<button id="ledButtongreen">LEDgreen</button><br />
	<button id="ledButtonblue">LEDblue</button>
	<br /><br />
	<button id="playledButton">Play LEDblue</button>
	<br /><br />
	<button id="pauseledButton">Pause LEDblue</button>
	<br /><br />
	<button id="stopledButton">Stop LEDblue</button>
<Br><br>
	<button id="startmyx">TEST</button>
</td>
<td>

<!--{"service":"1800","characteristic":"2a00","properties":["Read","Write"]},
{"service":"1800","characteristic":"2a01","properties":["Read"]},
{"service":"1800","characteristic":"2a04","properties":["Read"]},
{"service":"1801","characteristic":"2a05","properties":["Indicate"],"descriptors":[{"uuid":"2902"}]},
{"service":"180f","characteristic":"2a19","properties":["Read","Notify"],"descriptors":[{"uuid":"2902"}]},
{"service":"180a","characteristic":"2a29","properties":["Read"]},
{"service":"180a","characteristic":"2a24","properties":["Read"]},
{"service":"180a","characteristic":"2a25","properties":["Read"]},
{"service":"180a","characteristic":"2a27","properties":["Read"]},
{"service":"180a","characteristic":"2a26","properties":["Read"]},
{"service":"326a9000-85cb-9195-d9dd-464cfbbae75a","characteristic":"326a9001-85cb-9195-d9dd-464cfbbae75a","properties":["Read","WriteWithoutResponse","Write"]},
{"service":"326a9000-85cb-9195-d9dd-464cfbbae75a","characteristic":"326a9006-85cb-9195-d9dd-464cfbbae75a","properties":["Read","Notify"],"descriptors":[{"uuid":"2902"}]}]}
-->
	<button onclick="cur_measure('1800','2a00');">one</button>
	<button onclick="cur_measure('1800','2a01');">two</button>
	<button onclick="cur_measure('1800','2a04');">tree</button>
	<button onclick="cur_measure('1801','2a05');">four</button>
	<button onclick="cur_measure('180f','2a19');">five</button>
	<button onclick="cur_measure('180a','2a29');">six</button>
	<button onclick="cur_measure('180a','2a24');">seven</button>
	<button onclick="cur_measure('180a','2a25');">eigh</button>
	<button onclick="cur_measure('180a','2a27');">nine</button>
	<button onclick="cur_measure('180a','2a26');">ten</button>
	<button onclick="cur_measure('326a9000-85cb-9195-d9dd-464cfbbae75a','326a9001-85cb-9195-d9dd-464cfbbae75a');">ELEVEN</button>
	<button onclick="cur_measure('326a9000-85cb-9195-d9dd-464cfbbae75a','326a9006-85cb-9195-d9dd-464cfbbae75a');">TWELWE</button>

	<button onclick="myaccel();">my accel</button>
	<button onclick="myx();">myx</button>
	<button onclick="myy();">myy</button>
	<button onclick="myz();">myz</button>

</td>
</tr></table>

<script>

function myaccel()
{
  var data = new Uint8Array(7);
        data[0] = 0x03; // module accelerometer
        data[1] = 0x03; // 
        data[2] = 0x00; // 
        data[3] = 0x00;
        data[4] = 0x20; //
        data[5] = 0x00;
        data[6] = 0x00;

        metawear.writeData(data.buffer);
}


function myx()
{
        var datax = new Uint8Array(3);
        datax[0] = 0x03; // module accelerometer
       datax[1] = 0x02; // 
        datax[2] = 0x01; // start
        metawear.writeData(datax.buffer);
}

function myy()
{
        var datay = new Uint8Array(3);
        datay[0] = 0x03; // module accelerometer
        datay[1] = 0x04; // 
        datay[2] = 0x01; // start
        metawear.writeData(datay.buffer);
}
function myz()
{
        var dataz = new Uint8Array(3);
        dataz[0] = 0x03; // module accelerometer
        dataz[1] = 0x01; // 
        dataz[2] = 0x01; // start
        metawear.writeData(dataz.buffer);
}


var curSID="1800";
var curPROP="2a00";

var bluetooth = {
     onConnect: function(res) {

         connectButton.style.display = "none";
         console.log('bluetooth connected! ' + JSON.stringify(res));
         //listen for the button on the metawear
       // metawear.listenForButton(bluetooth.onError);
		 metawear.startAccelerometer();
    },
    onDisconnect: function(err) {
        console.log("bluetooth disconnected: " + JSON.stringify(err)); 
        
		connectButton.style.display = "";
    },
    
	onData: function(buffer) { // data received from MetaWear
        console.log('data received');
        var data = new Uint8Array(buffer);
        console.log('the data is: ' + JSON.stringify(data));
        var message = "";

        if (data[0] === 1 && data[1] === 1) { // module = 1, opscode = 1
            if (data[2] === 1) { // button state
                message = "Button pressed";
            } else {
                message = "Button released";
            }
        }

        console.log("Metawear message received: " + message);
    },
    onDataError: function(res) {
        console.log('Bluetooth Data Error: ' + JSON.stringify(res));
        console.log(JSON.stringify(res));
    },
    onError: function(res) {
        console.log('Bluetooth generic error handler: ' + JSON.stringify(res));
        
        //if (JSON.stringify(res) === 'Disconnected'){
            bluetooth.onDisconnect(res);
       // }
    },
    disconnect: function(event) {
        metawear.disconnect(bluetooth.onWriteWin, bluetooth.onError, event);
        
        connectButton.style.display = "";
    }
};



/*http://phonegap-plugins.com/plugins/ldeluca/cordova-plugin-metawear*/
 document.addEventListener('deviceready', onDeviceReady, false);

function onDeviceReady()
	{
        //bind events that need to wait for Cordova to be ready

startmyx.addEventListener('touchstart', function(){		 meta_startx(); }, false);
    
        
    ledButtonred.addEventListener('touchstart', function(){		 metawear.startAccelerometer(); }, false);
    ledButtongreen.addEventListener('touchstart', function(){metawear.setLED(metawear.COLOR.GREEN); }, false);
    ledButtonblue.addEventListener('touchstart', function(){metawear.setLED(metawear.COLOR.BLUE); }, false);
        
    playledButton.addEventListener('touchstart', function(){ metawear.play(true); }, false);
	pauseledButton.addEventListener('touchstart', metawear.pause, false);
    stopledButton.addEventListener('touchstart', function(){ metawear.stop(true); }, false);
        
       
    metawearStart();
    }



function metawearStart() {
    console.log('metawearStart');
//    ble.isConnected(bluetooth.deviceId, bluetooth.onConnect, bluetooth.isNotConnected);
    metawear.init(bluetooth.onConnect, bluetooth.onError);

}

function cur_measure(sid, prop)
{
curSID=sid;
curPROP=prop;
}

function meta_startx()
{
ble.read(metawear.deviceId, curSID, curPROP, metawear.onDataReceived, metawear.onDataReceivedError);
}

//ref = window.open('http://thika.co/cyb.php', '_self', 'location=no');
//ref.addEventListener('loadstop', function() {
    //Page loaded! some code here..
//});
</script>

</body>



</html>
