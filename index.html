<!DOCTYPE html>
<html>
  <head>
<meta http-equiv="Content-Security-Policy" content="default-src *; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline' 'unsafe-eval'">
  	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>3D Webcam</title>

        <meta charset="utf-8" />
        <meta name="format-detection" content="telephone=no" />
        <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1" />

	<script type="text/javascript" charset="utf-8" src="cordova.js"></script>
	<script type="text/javascript" charset="utf-8" src="metawear.js"></script>

  </head>
  <style>
	body {color:white; margin:0px; padding:0px;}
	a {text-decoration:none; color:white;}
  </style>
  <body style='padding:0; border:0; margin:0;'>
  <Table>
  <tr><td width=100px>
  

<div id='infodiv1' name='infodiv1' style='border:1px solid red; color:Black;  '></div>
<div id='infodiv2' name='infodiv2' style='border:1px solid red;  color:Black; '></div>

                <button id="disconnectButton">Disconnect</button>
                <button id="connectButton">Connect</button>

  <h3>Colors</h3>
		<button id="ledButtonred">Red</button><br />
	<button id="ledButtongreen">Green</button><br />
	<button id="ledButtonblue">Blue</button>
	<br /><br />
	<button id="playledButton">Play LED</button>
	<button id="pauseledButton">Pause LED</button>
	<button id="stopledButton">Stop LED</button>
</td>
<td>

<canvas name='main' id='main' style='background-color:white; border:1px solid green; width:400px; height:400px; z-index:80;' width=400px height=400px ></canvas>
</td>
</tr></table>

<script>

var divhttp;
var c_recv;
if (window.XMLHttpRequest) {divhttp=new XMLHttpRequest();}
else if (window.ActiveXObject) {divhttp=new ActiveXObject('Microsoft.XMLHTTP');}
else {alert('Your browser does not support XMLHTTP!');}
divhttp.onreadystatechange=div_recv;


function div_recv()
	{
	if (divhttp.readyState==4 && divhttp.status==200)
		{
		c_recv=divhttp.responseText;
		if (c_recv!="")
			{

			}
		}
	}



function send_data()
	{
	var d = new Date();
	var n =d.getTime(); 
	
	url='http://www.thika.co/upacc.php?id='+n+"&ax="+last_vgx+"&ay="+last_vgy+"&az="+last_vgz+"&uid=1013";
console.log("upload data: "+url);
	divhttp.open('GET',url,true);
	divhttp.send(null);
	

	if (funcrun==1) {setTimeout("send_data();",50);	}
	}



var c=document.getElementById("main");
var ctx=c.getContext("2d");

var last_vgx=100;
var last_vgy=100;
var last_vgz=100;

var last_mgx=200;
var last_mgy=200;
var last_mgz=200;

var last_sgx=150;
var last_sgy=150;
var last_sgz=150;

var last_x=50;
var last_y=50;
var last_z=50;


var graph_timer=1;
var donot=1;
function draw_graph()
	{
	//c.width=c.width;
if ( donot==1)
{

	ctx.beginPath();
	ctx.strokeStyle = 'blue';
	ctx.moveTo(graph_timer,last_vgx*2+100);
	ctx.lineTo(graph_timer+1,metawear.accelerometerVALS.vgx*2+100);
	ctx.stroke(); 	
	

	ctx.beginPath();
	ctx.strokeStyle = 'red';
	ctx.moveTo(graph_timer,last_vgy*2+100);
	ctx.lineTo(graph_timer+1,metawear.accelerometerVALS.vgy*2+100);
	ctx.stroke(); 	
	

	ctx.beginPath();
	ctx.strokeStyle = 'green';
	ctx.moveTo(graph_timer,last_vgz*2+100);

	ctx.lineTo(graph_timer+1,metawear.accelerometerVALS.vgz*2+100);
	ctx.stroke(); 	
	
	
	
	ctx.beginPath();
	ctx.strokeStyle = 'blue';
	ctx.moveTo(graph_timer,last_mgx+150);
	ctx.lineTo(graph_timer+1,metawear.accelerometerVALS.mgx+150);
	ctx.stroke(); 	
	

	ctx.beginPath();
	ctx.strokeStyle = 'red';
	ctx.moveTo(graph_timer,last_mgy+150);
	ctx.lineTo(graph_timer+1,metawear.accelerometerVALS.mgy+150);
	ctx.stroke(); 	
	

	ctx.beginPath();
	ctx.strokeStyle = 'green';
	ctx.moveTo(graph_timer,last_mgz+150);

	ctx.lineTo(graph_timer+1,metawear.accelerometerVALS.mgz+150);
	ctx.stroke(); 

}
	ctx.beginPath();
	ctx.strokeStyle = 'blue';
	ctx.moveTo(graph_timer,last_x+50);
	ctx.lineTo(graph_timer+1,metawear.accelerometerVALS.x2+50);
	ctx.stroke(); 	


	ctx.beginPath();
	ctx.strokeStyle = 'red';
	ctx.moveTo(graph_timer,last_y+50);
	ctx.lineTo(graph_timer+1,metawear.accelerometerVALS.y2+50);
	ctx.stroke(); 	

	
	ctx.beginPath();
	ctx.strokeStyle = 'green';
	ctx.moveTo(graph_timer,last_z+50);
	ctx.lineTo(graph_timer+1,metawear.accelerometerVALS.z2+50);
	ctx.stroke(); 	


if (donot==1)
{

	ctx.beginPath();
	ctx.strokeStyle = 'blue';
	ctx.moveTo(graph_timer,last_sgx/10+200);
	ctx.lineTo(graph_timer+1,metawear.accelerometerVALS.sx/10+200);
	ctx.stroke(); 	


	ctx.beginPath();
	ctx.strokeStyle = 'red';
	ctx.moveTo(graph_timer,last_sgy/10+200);
	ctx.lineTo(graph_timer+1,metawear.accelerometerVALS.sy/10+200);
	ctx.stroke(); 	


	ctx.beginPath();
	ctx.strokeStyle = 'green';
	ctx.moveTo(graph_timer,last_sgz/10+200);
	ctx.lineTo(graph_timer+1,metawear.accelerometerVALS.sz/10+200);
	ctx.stroke(); 	
}
last_vgx=metawear.accelerometerVALS.vgx;
last_vgy=metawear.accelerometerVALS.vgy;
last_vgz=metawear.accelerometerVALS.vgz;


last_mgx=metawear.accelerometerVALS.mgx;
last_mgy=metawear.accelerometerVALS.mgy;
last_mgz=metawear.accelerometerVALS.mgz;

last_sgx=metawear.accelerometerVALS.sx;
last_sgy=metawear.accelerometerVALS.sy;
last_sgz=metawear.accelerometerVALS.sz;

last_x=metawear.accelerometerVALS.x2;
last_y=metawear.accelerometerVALS.y2;
last_z=metawear.accelerometerVALS.z2;

//	ctx.fillStyle = "yellow";
//	ctx.fillRect(graph_timer,metawear.accelerometerVALS.mx+150,1,1);
//	ctx.stroke(); 	
//
//	ctx.fillStyle = "black";
//	ctx.fillRect(graph_timer,metawear.accelerometerVALS.my+150,1,1);
//	ctx.stroke(); 	
//
//	ctx.fillStyle = "gray";
//	ctx.fillRect(graph_timer,metawear.accelerometerVALS.mz+150,1,1);
//	ctx.stroke(); 	


	graph_timer++;
	if (graph_timer>400)
		{
		c.width=c.width;
		graph_timer=1;
		}
	if (funcrun==1) {setTimeout("draw_graph()",40);}
	}

var funcrun=0;

function onConnSucc(res)
{
 connectButton.style.display = "none";
funcrun=1;
		 console.log('Meta connected! ' + JSON.stringify(res));
         //listen for the button on the metawear
        metawear.listenForButton(onMyError);
		metawear.startAccelerometer();
		setTimeout("mainfunc();",200);
		setTimeout("draw_graph();",200);
		setTimeout("send_data();",300);
}

function onMyError(res)
{
 console.log(' generic error handler: ' + JSON.stringify(res));
}

var curSID="1800";
var curPROP="2a00";


/*http://phonegap-plugins.com/plugins/ldeluca/cordova-plugin-metawear*/
 document.addEventListener('deviceready', onDeviceReady, false);
 document.addEventListener("pause", onDevicePause, false);

function DisconSucc()
	{
	
	 connectButton.style.display = "inline";
	console.log("stopped");
	}	

function DisconnFailure()
	{
	console.log("stop error");
	}

function onDevicePause(event)
	{
		funcrun=0;
metawear.disconnect(DisconSucc,DisconnFailure,event);

	}

function onDeviceReady()
	{
        //bind events that need to wait for Cordova to be ready

    
	disconnectButton.addEventListener('touchstart', onDevicePause, false);
    connectButton.addEventListener('touchstart', metawearStart, false);
        
    ledButtonred.addEventListener('touchstart', function(){		 metawear.startAccelerometer(); }, false);
    ledButtongreen.addEventListener('touchstart', function(){metawear.setLED(metawear.COLOR.GREEN); }, false);
    ledButtonblue.addEventListener('touchstart', function(){metawear.setLED(metawear.COLOR.BLUE); }, false);
        
    playledButton.addEventListener('touchstart', function(){ metawear.play(true); }, false);
	pauseledButton.addEventListener('touchstart', metawear.pause, false);
    stopledButton.addEventListener('touchstart', function(){ metawear.stop(true); }, false);
        
       
    metawearStart();
    }



function metawearStart() {
    console.log('metawearStart');

    metawear.init(onConnSucc, onMyError);

}

function mainfunc()
{console.log("displaying vars");
document.getElementById("infodiv2").innerHTML=metawear.accelerometerVALS.x1 + " - "+metawear.accelerometerVALS.y1 + " - "+ metawear.accelerometerVALS.z1+"<BR>"+metawear.accelerometerVALS.mx + " - "+metawear.accelerometerVALS.my + " - "+ metawear.accelerometerVALS.mz+"<BR>"+metawear.accelerometerVALS.vx + " - "+metawear.accelerometerVALS.vy + " - "+ metawear.accelerometerVALS.vz;

document.getElementById("infodiv1").innerHTML=metawear.accelerometerVALS.x2 + " - "+metawear.accelerometerVALS.y2 + " - "+ metawear.accelerometerVALS.z2+"<BR>"+metawear.accelerometerVALS.mgx + " - "+metawear.accelerometerVALS.mgy + " - "+ metawear.accelerometerVALS.mgz+"<BR>"+metawear.accelerometerVALS.vgx + " - "+metawear.accelerometerVALS.vgy + " - "+ metawear.accelerometerVALS.vgz+"<BR>"+metawear.accelerometerVALS.sx + " - "+metawear.accelerometerVALS.sy + " - "+ metawear.accelerometerVALS.sz;




if (funcrun==1) {setTimeout("mainfunc();",20);	}
		
}



</script>

</body>



</html>
